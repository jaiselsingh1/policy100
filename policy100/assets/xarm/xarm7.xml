<!--
  xArm7 with gripper - CORRECTED GRIPPER STRUCTURE
  
  Key changes:
  1. drive_joint is now on left_outer_knuckle (not gripper base)
  2. Both outer knuckles have matching structure
  3. Equality constraints properly couple the joints
  
  The gripper is a parallel-jaw gripper where:
  - Fingers open/close along the Y-axis (Â±Y direction)
  - drive_joint controls the left finger
  - right_outer_knuckle_joint mirrors the left via equality constraint
-->
<mujoco model="xarm7">
  <body name="link_base" pos="0 0 0" childclass="xarm7">
    <geom name="base_visual" type="mesh" mesh="link_base" material="white" contype="0" conaffinity="0"/>
    <geom name="base_collision" type="cylinder" size="0.065 0.05" pos="0 0 0.05" rgba="1 1 1 0" group="3"/>
    
    <body name="link1" pos="0 0 0.267">
      <inertial pos="-0.0002 0.02905 -0.01233" mass="2.382" diaginertia="0.0056905 0.0049566 0.003316654"/>
      <joint name="joint1" range="-6.28 6.28" damping="10"/>
      <geom name="link1_visual" type="mesh" mesh="link1" material="white" contype="0" conaffinity="0"/>
      <geom name="link1_collision" type="cylinder" size="0.055 0.06" pos="0 0 -0.03" rgba="1 1 1 0" group="3"/>
      
      <body name="link2" pos="0 0 0" euler="-1.5708 0 0">
        <inertial pos="0.00022 -0.12856 0.01735" mass="1.869" diaginertia="0.0095989 0.00382472 0.007565669"/>
        <joint name="joint2" range="-2.059 2.0944" damping="10"/>
        <geom name="link2_visual" type="mesh" mesh="link2" material="white" contype="0" conaffinity="0"/>
        <geom name="link2_collision" type="capsule" size="0.048" fromto="0 0 0 0 -0.293 0" rgba="1 1 1 0" group="3"/>
        
        <body name="link3" pos="0 -0.293 0" euler="1.5708 0 0">
          <inertial pos="0.0466 -0.02463 -0.00768" mass="1.6383" diaginertia="0.00310955 0.00264483 0.0026624"/>
          <joint name="joint3" range="-6.28 6.28" damping="5"/>
          <geom name="link3_visual" type="mesh" mesh="link3" material="white" contype="0" conaffinity="0"/>
          <geom name="link3_collision" type="cylinder" size="0.045 0.035" pos="0.0525 0 0" euler="0 1.5708 0" rgba="1 1 1 0" group="3"/>
          
          <body name="link4" pos="0.0525 0 0" euler="1.5708 0 0">
            <inertial pos="0.07047 -0.11575 0.012" mass="1.7269" diaginertia="0.005889 0.00359703 0.00543244"/>
            <joint name="joint4" range="-0.19198 3.927" damping="5"/>
            <geom name="link4_visual" type="mesh" mesh="link4" material="white" contype="0" conaffinity="0"/>
            <geom name="link4_collision" type="capsule" size="0.042" fromto="0 0 0 0.0775 -0.3425 0" rgba="1 1 1 0" group="3"/>
            
            <body name="link5" pos="0.0775 -0.3425 0" euler="1.5708 0 0">
              <inertial pos="-0.00032 0.01604 -0.026" mass="1.3203" diaginertia="0.00534665 0.0049779 0.0013624"/>
              <joint name="joint5" range="-6.28 6.28" damping="5"/>
              <geom name="link5_visual" type="mesh" mesh="link5" material="white" contype="0" conaffinity="0"/>
              <geom name="link5_collision" type="cylinder" size="0.038 0.04" rgba="1 1 1 0" group="3"/>
              
              <body name="link6" pos="0 0 0" euler="1.5708 0 0">
                <inertial pos="0.06469 0.03278 0.02141" mass="1.325" diaginertia="0.0014745 0.0019037 0.0023652"/>
                <joint name="joint6" range="-1.69297 3.14159" damping="2"/>
                <geom name="link6_visual" type="mesh" mesh="link6" material="gray" contype="0" conaffinity="0"/>
                <geom name="link6_collision" type="capsule" size="0.032" fromto="0 0 0 0.076 0.097 0" rgba="1 1 1 0" group="3"/>
                
                <body name="link7" pos="0.076 0.097 0" euler="-1.5708 0 0">
                  <inertial pos="0 -0.00677 -0.01098" mass="0.17" diaginertia="9.3e-05 5.87e-05 0.000132"/>
                  <joint name="joint7" range="-6.28 6.28" damping="2"/>
                  <geom name="link7_visual" type="mesh" mesh="link7" material="gray" contype="0" conaffinity="0"/>
                  <geom name="link7_collision" type="cylinder" size="0.032 0.012" pos="0 0 -0.012" rgba="1 1 1 0" group="3"/>
                  <site name="ee_site" pos="0 0 0" size="0.008" rgba="1 0 0 0.5"/>
                  
                  <!-- ========================================== -->
                  <!-- GRIPPER - CORRECTED STRUCTURE              -->
                  <!-- ========================================== -->
                  <body name="xarm_gripper_base_link" pos="0 0 0">
                    <inertial pos="0 0 0.06" mass="0.5" diaginertia="0.001 0.001 0.001"/>
                    <geom name="gripper_base_visual" type="mesh" mesh="gripper_base" material="dark_gray" contype="0" conaffinity="0"/>
                    <geom name="gripper_base_collision" type="box" size="0.03 0.03 0.04" pos="0 0 0.055" rgba="1 1 1 0" group="3"/>
                    
                    <!-- LEFT SIDE -->
                    <!-- The drive_joint is now ON the left_outer_knuckle body -->
                    <body name="left_outer_knuckle" pos="0 0.035 0.059">
                      <inertial pos="0 0.02 0.02" mass="0.03" diaginertia="0.00001 0.00001 0.00001"/>
                      <joint name="drive_joint" type="hinge" axis="1 0 0" range="0 0.85" damping="0.5"/>
                      <geom name="left_outer_knuckle_visual" type="mesh" mesh="left_outer_knuckle" class="gripper" contype="0" conaffinity="0"/>
                      <geom name="left_outer_knuckle_collision" type="box" size="0.008 0.012 0.018" pos="0 0.018 0.015" rgba="1 1 1 0" group="3"/>
                      
                      <body name="left_finger" pos="0 0.035465 0.042039">
                        <inertial pos="0 0.01 0.03" mass="0.02" diaginertia="0.00001 0.00001 0.00001"/>
                        <joint name="left_finger_joint" type="hinge" axis="-1 0 0" range="-0.85 0.85" damping="0.2"/>
                        <geom name="left_finger_visual" type="mesh" mesh="left_finger" class="finger" contype="0" conaffinity="0"/>
                        <geom name="left_finger_collision1" type="box" size="0.006 0.008 0.025" pos="0 0.008 0.025" class="finger"/>
                        <geom name="left_finger_collision2" type="box" size="0.006 0.012 0.008" pos="0 0.012 0.058" class="finger"/>
                        <site name="left_finger_tip" pos="0 0.012 0.065" size="0.004" rgba="1 0 0 0.5"/>
                      </body>
                    </body>
                    
                    <body name="left_inner_knuckle" pos="0 0.02 0.074">
                      <inertial pos="0 0.01 0.015" mass="0.02" diaginertia="0.00001 0.00001 0.00001"/>
                      <joint name="left_inner_knuckle_joint" type="hinge" axis="1 0 0" range="-0.85 0.85" damping="0.2"/>
                      <geom name="left_inner_knuckle_visual" type="mesh" mesh="left_inner_knuckle" class="gripper" contype="0" conaffinity="0"/>
                      <geom name="left_inner_knuckle_collision" type="box" size="0.006 0.006 0.015" pos="0 0.01 0.015" rgba="1 1 1 0" group="3"/>
                    </body>
                    
                    <!-- RIGHT SIDE - mirrors left side -->
                    <body name="right_outer_knuckle" pos="0 -0.035 0.059">
                      <inertial pos="0 -0.02 0.02" mass="0.03" diaginertia="0.00001 0.00001 0.00001"/>
                      <joint name="right_outer_knuckle_joint" type="hinge" axis="1 0 0" range="-0.85 0" damping="0.5"/>
                      <geom name="right_outer_knuckle_visual" type="mesh" mesh="right_outer_knuckle" class="gripper" contype="0" conaffinity="0"/>
                      <geom name="right_outer_knuckle_collision" type="box" size="0.008 0.012 0.018" pos="0 -0.018 0.015" rgba="1 1 1 0" group="3"/>
                      
                      <body name="right_finger" pos="0 -0.035465 0.042039">
                        <inertial pos="0 -0.01 0.03" mass="0.02" diaginertia="0.00001 0.00001 0.00001"/>
                        <joint name="right_finger_joint" type="hinge" axis="1 0 0" range="-0.85 0.85" damping="0.2"/>
                        <geom name="right_finger_visual" type="mesh" mesh="right_finger" class="finger" contype="0" conaffinity="0"/>
                        <geom name="right_finger_collision1" type="box" size="0.006 0.008 0.025" pos="0 -0.008 0.025" class="finger"/>
                        <geom name="right_finger_collision2" type="box" size="0.006 0.012 0.008" pos="0 -0.012 0.058" class="finger"/>
                        <site name="right_finger_tip" pos="0 -0.012 0.065" size="0.004" rgba="0 0 1 0.5"/>
                      </body>
                    </body>
                    
                    <body name="right_inner_knuckle" pos="0 -0.02 0.074">
                      <inertial pos="0 -0.01 0.015" mass="0.02" diaginertia="0.00001 0.00001 0.00001"/>
                      <joint name="right_inner_knuckle_joint" type="hinge" axis="-1 0 0" range="-0.85 0.85" damping="0.2"/>
                      <geom name="right_inner_knuckle_visual" type="mesh" mesh="right_inner_knuckle" class="gripper" contype="0" conaffinity="0"/>
                      <geom name="right_inner_knuckle_collision" type="box" size="0.006 0.006 0.015" pos="0 -0.01 0.015" rgba="1 1 1 0" group="3"/>
                    </body>
                    
                    <!-- TCP -->
                    <body name="link_tcp" pos="0 0 0.172">
                      <site name="tcp_site" pos="0 0 0" size="0.006" rgba="0 1 0 1"/>
                    </body>
                  </body>
                </body>
              </body>
            </body>
          </body>
        </body>
      </body>
    </body>
  </body>
</mujoco>